```html
{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    /* Enhanced Visual Design System */
    :root {
        --primary-color: #0d6efd;
        --success-color: #198754;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #0dcaf0;
        --light-bg: #f8f9fa;
        --border-color: #dee2e6;
        --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        --shadow-md: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        --transition-speed: 0.3s;
    }
    
    /* Enhanced Cards with Hover Effects */
    .summary-card {
        border: none;
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-speed) ease;
        border-radius: 0.75rem;
        overflow: hidden;
    }
    
    .summary-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    /* Enhanced Form Controls */
    .form-control:focus,
    .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }

    /* Button Enhancements */
    .btn {
        transition: all var(--transition-speed) ease;
        border-radius: 0.375rem;
        font-weight: 500;
    }
    
    .btn:hover:not(:disabled) {
        transform: translateY(-1px);
    }

    /* Table Enhancements */
    .table {
        margin-bottom: 0;
    }
    
    .table tbody tr {
        transition: background-color var(--transition-speed) ease;
    }
    
    .table tbody tr:hover {
        background-color: var(--light-bg);
    }

    /* Badge Improvements */
    .badge {
        font-weight: 500;
        padding: 0.35em 0.65em;
        font-size: 0.8rem;
    }

    /* Empty State Styling */
    .empty-state {
        padding: 3rem 1rem;
        text-align: center;
    }
    
    .empty-state-icon {
        font-size: 4rem;
        color: #dee2e6;
        margin-bottom: 1rem;
    }

    /* Responsive Improvements */
    @media (max-width: 768px) {
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .btn-group .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col">
            <!-- Main Card Container -->
            <div class="card summary-card shadow-sm border-0 rounded-5 overflow-hidden">
                <!-- ================= HEADER ================= -->
                <div class="card-header bg-primary text-white px-4 py-3 border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 fw-semibold">
                            <i class="bi bi-folder2-open me-2"></i> All Projects
                        </h4>
                        <a href="{% url 'projects:create_project' %}" class="btn btn-outline-light btn-sm fw-medium">
                            <i class="bi bi-plus-lg me-1"></i> Create Project
                        </a>
                    </div>
                </div>

                <!-- ================= FILTERS ================= -->
                <div class="card-body border-bottom bg-light-subtle">
                    <form method="get" id="filter-form" class="needs-validation" novalidate>
                        <div class="row g-3">
                            <!-- Search -->
                            <div class="col-md-4">
                                <label for="id_search" class="form-label fw-medium">Search</label>
                                <input
                                    type="text"
                                    name="search"
                                    id="id_search"
                                    value="{{ filters_applied.search|default_if_none:'' }}"
                                    class="form-control"
                                    placeholder="Project name or HS ID"
                                />
                            </div>
                            <!-- Status -->
                            <div class="col-md-4">
                                <label for="id_status" class="form-label fw-medium">Status</label>
                                <select name="status" id="id_status" class="form-select">
                                    <option value="">All Statuses</option>
                                    {% for status in filter_options.statuses %}
                                        <option
                                            value="{{ status.id }}"
                                            {% if filters_applied.status|stringformat:"s" == status.id|stringformat:"s" %}selected{% endif %}
                                        >
                                            {{ status.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- Product -->
                            <div class="col-md-4">
                                <label for="id_product" class="form-label fw-medium">Product</label>
                                <select name="product" id="id_product" class="form-select">
                                    <option value="">All Products</option>
                                    {% for product in filter_options.products %}
                                        <option
                                            value="{{ product.id }}"
                                            {% if filters_applied.product|stringformat:"s" == product.id|stringformat:"s" %}selected{% endif %}
                                        >
                                            {{ product.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- Region -->
                            <div class="col-md-4">
                                <label for="region-select" class="form-label fw-medium">Region</label>
                                <select name="region" id="region-select" class="form-select">
                                    <option value="">All Regions</option>
                                    {% for region in filter_options.regions %}
                                        <option
                                            value="{{ region.id }}"
                                            {% if filters_applied.region|stringformat:"s" == region.id|stringformat:"s" %}selected{% endif %}
                                        >
                                            {{ region.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- City -->
                            <div class="col-md-4">
                                <label for="city-select" class="form-label fw-medium">City</label>
                                <select name="city" id="city-select" class="form-select">
                                    <option value="">All Cities</option>
                                    {% for city in filter_options.cities %}
                                        <option
                                            value="{{ city.id }}"
                                            {% if filters_applied.city|stringformat:"s" == city.id|stringformat:"s" %}selected{% endif %}
                                        >
                                            {{ city.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- DPM -->
                            <div class="col-md-4">
                                <label for="id_dpm" class="form-label fw-medium">DPM</label>
                                <select name="dpm" id="id_dpm" class="form-select">
                                    <option value="">All DPMs</option>
                                    {% for dpm in filter_options.dpms %}
                                        <option
                                            value="{{ dpm.id }}"
                                            {% if filters_applied.dpm|stringformat:"s" == dpm.id|stringformat:"s" %}selected{% endif %}
                                        >
                                            {{ dpm.get_full_name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col d-flex gap-2">
                                <button type="submit" class="btn btn-primary btn-sm">
                                    <i class="bi bi-funnel-fill"></i> Apply Filters
                                </button>
                                <a href="{% url 'projects:project_list' %}" class="btn btn-secondary btn-sm">
                                    <i class="bi bi-x-circle"></i> Clear Filters
                                </a>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- ================= TABLE ================= -->
                <div class="card-body p-0">
                    {% if projects %}
                        <div class="table-responsive-lg">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light text-nowrap border-top">
                                    <tr>
                                        <th>HS&nbsp;ID</th>
                                        <th>Project Name</th>
                                        <th>Opportunity ID</th>
                                        <th>Builder</th>
                                        <th>City</th>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Status</th>
                                        <th>DPM</th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for project in projects %}
                                    <tr>
                                        <td class="fw-semibold">{{ project.hs_id }}</td>
                                        <td class="text-wrap" style="min-width:10rem">
                                            {{ project.project_name }}
                                        </td>
                                        <td class="text-truncate" style="max-width:14rem">
                                            {{ project.opportunity_id|default:"â€”" }}
                                        </td>
                                        <td>{{ project.builder_name }}</td>
                                        <td>{{ project.city.name }}</td>
                                        <td>{{ project.product.name }}</td>
                                        <td>{{ project.quantity }}</td>
                                        <td>
                                            {% if project.current_status %}
                                                <span class="badge bg-info text-dark fw-medium">
                                                    {{ project.current_status.name }}
                                                </span>
                                            {% else %}
                                                <span class="text-muted">No status</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ project.dpm.get_full_name }}</td>
                                        <td class="text-center text-nowrap">
                                            <a
                                                href="{% url 'projects:project_detail' project.id %}"
                                                class="btn btn-outline-light btn-sm bg-primary border-0"
                                                title="View Details"
                                            >
                                                <i class="bi bi-eye text-white"></i>
                                            </a>
                                            {% if user == project.dpm %}
                                                <a
                                                    href="{% url 'projects:project_management' project.id %}"
                                                    class="btn btn-outline-light btn-sm bg-primary border-0 ms-1"
                                                    title="Manage Project"
                                                >
                                                    <i class="bi bi-list-check text-white"></i>
                                                </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="bi bi-folder-x"></i>
                            </div>
                            <h5 class="text-muted">No projects found.</h5>
                            <p class="text-muted mb-0">Try adjusting your filters or create a new project.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const regionSelect = document.getElementById('region-select');
        const citySelect   = document.getElementById('city-select');

        // Helper to populate city dropdown
        const populateCities = (cities, selectedId = null) => {
            citySelect.innerHTML = '<option value="">All Cities</option>';
            cities.forEach(city => {
                const opt = document.createElement('option');
                opt.value       = city.id;
                opt.textContent = city.name;
                if (selectedId && String(selectedId) === String(city.id)) opt.selected = true;
                citySelect.appendChild(opt);
            });
        };

        // Only listen on change; initial population is server-side
        if (regionSelect) {
            regionSelect.addEventListener('change', e => {
                const regionId = e.target.value || 'all';
                fetch(`{% url 'projects:api_cities' %}?region=${encodeURIComponent(regionId)}`)
                    .then(r => r.json())
                    .then(populateCities)
                    .catch(err => console.error('Error fetching cities:', err));
            });
        }
    });
</script>
{% endblock %}
```
